{% extends "./inc/base.html" %} {% block style %}
<link rel="stylesheet" href="/static/admin/editormd/editormd.min.css" type="text/css">
{% endblock%} {% block content %}
<section class="vbox">
    <section id="bjax-target">
        <section class="hbox stretch">
            <!-- side content -->
            {% include "./inc/template_side.html" %}
            <!-- / side content -->
            <section>
                <section class="vbox">
                    <header class="header bg-light dk">
                        <ul class="nav nav-tabs pull-left">
                            <li class="active"><a data-toggle="tab" href="#"><i class="fa fa-comments text-muted"></i> PC端模板 </a></li>
                            <li class=""><a data-toggle="tab" href="/admin/database/imports"><i class="fa fa-user text-muted"></i> 移动端模板</a>
                            </li>
                        </ul>
                    </header>
                    <section class="scrollable wrapper">

                        <section class="panel panel-default">
                            <header class="panel-heading">
                                <!--<i data-title="" data-placement="bottom" data-toggle="tooltip" class="fa fa-info-sign text-muted" data-original-title="" title=""><i class="fa fa-question-circle"></i></i>-->

                                {% if breadcrumb|length == 0%} [ {% if position %} <a href="/admin/article/index" class="text-info">全部</a>{%else%}<strong>全部</strong>{%endif%}
                                {%for key ,val in controller.setup.DOCUMENT_POSITION %} {%if position != key %}<a href="/admin/article/index/position/{{key}}"
                                                                                                                  class="text-info">{{val}}</a>{%else%}<strong>{{val}}</strong>{% endif %}&nbsp; {% endfor
                                %}] {%endif%} {%if model|length > 1 %}[ 模型：{%if model_id ==null %}<strong>全部</strong>{%else%}
                                <a
                                        href="/admin/article/index/pid/{{pid}}/cate_id/{{cate_id}}" class="text-info"> 全部 </a>{%endif%}&nbsp; {% for val in modellist%} {% if model_id != val.id %}<a href="/admin/article/index/model_id/{{val.id}}/pid/{{pid}}/cate_id/{{cate_id}}"
                                                                                                                                                                                                      class="text-info">{{val.title}}</a>{% else %}<strong>{{val.title}}</strong>{% endif %}&nbsp;
                                {% endfor %} ]{% endif %} {% if groups %}[ 分组：{%if group_id ==null %}<strong>全部</strong>{%else%}
                                <a
                                        href="/admin/article/index/pid/{{pid}}/cate_id/{{cate_id}}"  class="text-info">全部</a>{%endif%} {%for key ,val in groups %} {% if group_id != key %}<a href="/admin/article/index/pid/{{pid}}/cate_id/{{cate_id}}/group_id/{{key}}"  class="text-info">{{val}}</a>{%
                                else %}<strong>{{val}}</strong>{% endif %}&nbsp; {% endfor %} ]{% endif %}
                            </header>
                            <div class="row wrapper">

                                <div class="col-sm-9 m-b-xs">
                                    <div class="">

                                        <div class="btn-group">
                                            <a class="btn btn-sm btn-info " id="get-code-btn">
                                                获取
                                            </a>
                                            <a class="btn btn-sm btn-info " id="fullscreen-btn">
                                                全屏
                                            </a>
                                        </div>
                                        <div class="btn-group">
                                            <a class="btn btn-sm btn-info ajax-post confirm" target-form="ids" href="#">
                                                移动
                                            </a>
                                            <a class="btn btn-sm btn-info ajax-post confirm" target-form="ids" href="#">
                                                复制
                                            </a>
                                            <a class="btn btn-sm btn-info ajax-post confirm" target-form="ids" href="#">
                                                粘贴
                                            </a>
                                        </div>

                                        <a class="btn btn-sm btn-info ajax-post confirm" target-form="ids" href="#">
                                            删除
                                        </a>
                                        <a class="btn btn-sm btn-info ajax-post confirm" target-form="ids" href="#">
                                            排序
                                        </a>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="input-group pull-right search-form">
                                        <input type="text" class="input-sm form-control" name="{{model.search_key|default('title', true)}}" placeholder="请输入关键字"
                                               value="{{http.get('title')}}">
                                        <span class="input-group-btn">
                        <button class="btn btn-sm btn-default" type="button" id="search" url="/admin/cms/list/model/{{model.name}}">搜索</button>
                      </span>
                                    </div>
                                </div>
                            </div>
                            <div id="layout">
                                <header class="hide">
                                    <h1>Chnage mode</h1>
                                    <p>Become to the code editor</p>
                                    <p>Modes : <select id="modes">
                                        <option value="">select modes</option>
                                    </select>&nbsp;&nbsp;Themes :
                                        <select id="themes">
                                            <option selected="selected" value="">select themes</option>
                                        </select>
                                    </p>
                                </header>

                                <div id="codes" class="hide">
            <textarea id="html-code">{{tempcon}}</textarea>
</div>
                                <div id="test-editormd" style="margin: 0">
                                    <textarea style="display:none;"></textarea>
                                </div>
                            </div>
                            <footer class="panel-footer">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="btn-group">
                                            <a class="btn btn-sm btn-default ajax-post confirm" target-form="ids" href="#">
                                                微信图文
                                            </a>
                                            <a class="btn btn-sm btn-default ajax-post confirm" target-form="ids" href="#">
                                                高级图文
                                            </a>
                                            <a class="btn btn-sm btn-default ajax-post confirm" target-form="ids" href="#">
                                                推送
                                            </a>
                                        </div>
                                    </div>

                                    <div class="col-md-6 text-right text-center-xs">
                                        {{pagerData | safe}}
                                    </div>
                                </div>
                            </footer>
                        </section>
                    </section>
                </section>
            </section>
        </section>
    </section>

</section>


{% endblock %} {% block script %}
<script src="/static/admin/editormd/editormd.min.js"></script>
<script type="text/javascript">
    var testEditor;

    function getCodeValue() {
        return (localStorage.modeName) ? $("#"+localStorage.modeName.replace("text/", "").replace("c/c++", "cpp")+"-code").val() : $("#html-code").val();
    }

    $(function() {
        testEditor = editormd("test-editormd", {
            width            : "100%",
            height           : 640,
            watch            : false,
            toolbar          : false,
            codeFold         : true,
            searchReplace    : true,
            placeholder      : "Enjoy coding!",
            value            : getCodeValue(),
            theme            : (localStorage.theme) ? localStorage.theme : "default",
            mode             : (localStorage.mode) ? localStorage.mode : "text/html",
            path             : '/static/admin/editormd/lib/'
        });

        $("#get-code-btn").bind("click", function() {
            alert(testEditor.getValue());
        });

        $("#fullscreen-btn").bind("click", function() {
            testEditor.fullscreen();
        });

        var select = $("#themes");

        for (var i = 0, len = editormd.themes.length; i < len; i ++)
        {
            var theme    = editormd.themes[i];
            var selected = (localStorage.theme == theme) ? " selected=\"selected\"" : "";
            select.append("<option value=\"" + theme + "\"" + selected + ">" + theme + "</option>");
        }

        select.change(function(){
            var theme = $(this).val();

            if (theme == "")
            {
                alert("theme == \"\"");
                return false;
            }

            localStorage.theme = theme;
            testEditor.setTheme(theme);
        });

        var modesSelect = $("#modes");
        var modeNames = ["text/html", "javascript", "php", "text/xml", "text/json", "java", "actionscript", "perl", "go", "python", "c/c++", "css", "ruby"];
        var modes     = ["text/html", "javascript", "php", "text/xml", "text/json", "clike", "javascript", "perl", "go", "python", "clike", "css", "ruby"];

        for (var i = 0, len = modes.length; i < len; i ++)
        {
            var mode    = modes[i];
            var selected = (localStorage.modeName == modeNames[i]) ? " selected=\"selected\"" : "";
            modesSelect.append("<option value=\"" + mode + "\"" + selected + " name=\"" + modeNames[i] + "\"" + selected + ">" + modeNames[i] + "</option>");
        }

        modesSelect.change(function(){
            var mode = $(this).val();
            var modeName = $(this).find("option:selected").attr("name");

            if (mode == "")
            {
                alert("mode == \"\"");
                return false;
            }

            localStorage.mode     = mode;
            localStorage.modeName = modeName;

            var code = getCodeValue();

            testEditor.setCodeMirrorOption("mode", mode);
            //testEditor.setCodeMirrorOption("value", code);
            testEditor.setValue(code);
        });
    });
</script>
{% endblock %}}