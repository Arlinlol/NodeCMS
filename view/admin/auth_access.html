{% extends "view/admin/inc/base.html" %}
{% block style%}
<link rel="stylesheet" href="/static/js/datatables/datatables.css" type="text/css"/>
{% endblock %}
{% block content %}
    <section class="hbox stretch">
        <section class="vbox">
            <header class="header bg-light dk">
                <div class="btn-group pull-right">
                    <a href="#asideres" class="btn btn-sm btn-default" data-toggle="class:show">
                        <i class="fa fa-plus text"></i>
                        <span class="text">添加用户</span>
                        <i class="fa fa-minus text-active"></i>
                        <span class="text-active">添加完成</span>
                    </a>
                    <button class="btn btn-default btn-sm" type="button"><i class="fa fa-check-square-o"></i> 启用</button>
                    <button class="btn btn-default btn-sm" type="button"><i class="fa fa-minus-square-o"></i> 禁用</button>
                    <button class="btn btn-default btn-sm" type="button"><i class="fa fa-trash-o"></i> 删除</button>

                </div>
                <p>权限管理</p>
            </header>
            <section class="scrollable wrapper">
                <form action="{:U('AuthManager/writeGroup')}" enctype="application/x-www-form-urlencoded" method="POST" class="form-horizontal auth-form">
                    <div id="category_tree"></div>
                    <input type="hidden" name="id" value="{{thisid}}" />
                    <button type="submit" class="btn submit-btn ajax-post" target-form="auth-form">确 定</button>
                    <button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
                </form>
                <section class="panel panel-default pos-rlt clearfix">
                    <header class="panel-heading">
                        <ul class="nav nav-pills pull-right">
                            <li>
                                <a class="panel-toggle text-muted" href="#"><i class="fa fa-caret-down text-active"></i><i class="fa fa-caret-up text"></i></a>
                            </li>
                        </ul>
                        Dropdown
                    </header>
                    <div class="panel-body clearfix">

                    </div>
                </section>
            </section>
        </section>

    </section>
{% endblock%}

{% block script%}
<script src="/static/js/datatables/jquery.dataTables.min.js"></script>
<script src="/static/js/datatables/jquery.csv-0.71.min.js"></script>
<script src="/static/js/parsley/parsley.min.js"></script>
<script src="/static/js/parsley/parsley.extend.js"></script>
<script src="/static/js/datatables/auth.js"></script>

<script>

    /* 生成HTML ul/li 形式 */
    function category_to_html(nodes){
        var html = [];
        var size = nodes.length;
        var left = null;
        var right = null;
        var text;
        var stack = [];

        html.push("<ul>");

        for (var i = 0; i < size; i++) {
            left = nodes[i];

            //text = [left["id"],left["title"]].join(",");
            text = '<span><label class="checkbox-inline i-checks">\
                    <input type="checkbox" value="option1"><i></i>\
                    '+left['title']+'\
                    </label></span>';
            if (i + 1 < size) {
                right = nodes[i + 1];
                /* 入深 */
                if (left["deep"] < right["deep"]) {
                    html.push("<li class='parent_li'>");
                    html.push(text);
                    html.push("<ul>");
                    stack.push(1);
                } else {
                    html.push("<li>");
                    html.push(text);
                    html.push("</li>");
                }
                /* 逐层跳出 */
                if (left["deep"] > right["deep"]) {
                    for (var j = 0; j < left["deep"] - right["deep"]; j++) {
                        stack.pop();
                        html.push( "</ul>");
                        html.push("</li>");
                    }
                }
            } else {
                if (stack.length > 0) {
                    html.push("<li>");
                    html.push(text);
                    html.push("</li>");
                    while (stack.pop()) {
                        html.push( "</ul>");
                        html.push("</li>");
                    }
                } else {
                    html.push("<li>");
                    html.push(text);
                    html.push("</li>");
                }
            }
        }
        html.push( "</ul>");
        return html.join("\n");
    }
    var id = $("input[name='id']").val();
    $.ajax({
        type: "POST",
        url: "/admin/auth/accessdata",
        data: {id:id},
        success: function (msg) {
            /* 展示生成的HTML */
            $("#category_tree").html(category_to_html(msg.node_list));
        }
            });


</script>
{% endblock %}